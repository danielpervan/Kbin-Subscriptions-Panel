// ==UserScript==
// @name         Kbin Subscriptions Panel
// @namespace    https://perry.dev
// @license      MIT
// @version      2.5
// @description  Adds a side panel with all magazine subscriptions.
// @author       Daniel Pervan
// @match        https://kbin.social/*
// @match        https://lab2.kbin.pub/*
// @match        https://lab3.kbin.pub/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=kbin.social
// ==/UserScript==

(function () {
    'use strict';
(()=>{var f=(l,e)=>()=>(l&&(e=l(l=0)),e);var $=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports);function G(l){if(typeof document<"u"){var e=document.createElement("style"),t=document.createTextNode(l);e.appendChild(t),document.head.appendChild(e)}}var A=f(()=>{});var R=f(()=>{A();G('body.subscription-panel-injected.extend-width:not(.subscription-panel-force-mobile,.subscription-panel-open) .kbin-container{max-width:1620px}body.subscription-panel-injected .subscription-panel-modal{position:fixed;top:0;left:0;width:100%;height:100%;z-index:99;background-color:#00000080;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(2px)}body.subscription-panel-injected .subscription-panel-modal-content{background-color:var(--kbin-section-bg);border:var(--kbin-options-border);color:var(--kbin-section-text-color);padding:2rem 1rem;height:fit-content;font-size:.8em;position:relative;max-width:600px;min-width:400px;width:100%;animation:modalopen .2s ease-in-out}body.subscription-panel-injected .subscription-panel-modal-content h1,body.subscription-panel-injected .subscription-panel-modal-content h2{margin-top:0;text-align:center}body.subscription-panel-injected .subscription-panel-modal-content .close{color:#aaa;font-size:28px;cursor:pointer;position:absolute;top:.5rem;right:1rem}body.subscription-panel-injected .subscription-panel-modal-content .close:hover{color:var(--kbin-sidebar-header-text-color)}body.subscription-panel-injected.rounded-edges .subscription-panel-modal-content{border-radius:.5rem}body.subscription-panel-injected.rounded-edges #subscription-panel-content{border-radius:0 0 .5rem .5rem}body.subscription-panel-injected.rounded-edges .subscription-panel-modal .danger{border-radius:.5rem}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open).fixed-navbar.topbar #subscription-panel-content{top:calc(50.5px + 1.1rem);max-height:calc(100vh - 50px - 1.1rem - 1em)}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open).fixed-navbar #subscription-panel-content{top:50px;max-height:calc(100vh - 50px - 1em)}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open).topbar #subscription-panel-content{top:1.1rem;max-height:calc(100vh - 1.1rem - 1em)}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open) #subscription-panel-content{position:sticky;overflow:auto;max-height:calc(100vh - 1em);top:0}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open) #subscription-panel-content>h3{position:sticky;top:-2.5em;background:var(--kbin-section-bg);z-index:3;margin-bottom:0}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open) #subscription-panel-content .search-box-container{position:sticky;top:1.25em;z-index:3;padding:1em 0;background:var(--kbin-section-bg)}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open) #subscription-panel-content .search-box-container .search-box-clear{top:1.2em}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open) #subscription-panel-content .last-clicked-container h3{position:sticky;top:7em;margin-top:0;z-index:2;background:var(--kbin-section-bg)}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open).subscription-panel-collapsed #subscription-panel-content .last-clicked-container h3{top:-1em;padding-top:1em}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open) #subscription-panel.edit-mode #subscription-panel-content{padding-top:0}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open) #subscription-panel.edit-mode .search-box-container{top:3.5em;margin-top:1em;padding:0 0 1em}body.subscription-panel-injected.subscription-panel-sticky:not(.subscription-panel-open) #subscription-panel.edit-mode #subscription-panel-edit-button{position:sticky;top:-.5em;margin:0;padding-top:1em;z-index:5;background:var(--kbin-section-bg)}body.subscription-panel-injected #subscription-panel .search-box-container{position:relative}body.subscription-panel-injected #subscription-panel .search-box-clear{position:absolute;top:.6em;right:1em;font-size:1.5em;display:none;cursor:pointer;transition:color .2s ease-in-out;animation:searchBoxClearShow .25s ease-in-out}@keyframes searchBoxClearShow{0%{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}body.subscription-panel-injected #subscription-panel .search-box-clear:hover{color:var(--kbin-sidebar-header-text-color)}body.subscription-panel-injected #subscription-panel .search-box-clear.active{display:block}body.subscription-panel-injected #subscription-panel-edit-button{position:absolute;top:0;left:0;margin:.5rem;padding:.5rem;z-index:5;color:var(--kbin-section-text-color);font-size:.8em;cursor:pointer;transition:font-size .2s ease-in-out}body.subscription-panel-injected #subscription-panel-edit-button i{transition:transform .2s ease-in-out}body.subscription-panel-injected #subscription-panel-edit-button:not(.active):hover i{color:var(--kbin-sidebar-header-text-color);transform:rotate(-25deg)}body.subscription-panel-injected #subscription-panel-edit-button.active{font-size:1.5em}body.subscription-panel-injected #subscription-panel-edit-button.active:hover{color:var(--kbin-link-hover-color)}body.subscription-panel-injected #subscription-panel-edit-button.active:hover i{transform:scale(1.2)}body.subscription-panel-injected #subscription-panel-settings-button{position:absolute;top:0;right:0;margin:.5rem;padding:.5rem;color:var(--kbin-section-text-color);font-size:.8em;cursor:pointer;transition:transform .2s ease-in-out;z-index:3}body.subscription-panel-injected #subscription-panel-settings-button:hover{color:var(--kbin-sidebar-header-text-color);transform:rotate(25deg)}body.subscription-panel-injected #subscription-panel-settings-button:active{animation:settingsbuttonclick .5s ease-in-out}@keyframes settingsbuttonclick{0%{transform:rotate(0)}to{transform:rotate(360deg)}}body.subscription-panel-injected .subscription-panel-settings-modal-content{max-width:600px;min-width:400px}body.subscription-panel-injected .subscription-panel-settings-modal-content ul{list-style:none;padding-inline:0}body.subscription-panel-injected .subscription-panel-settings-modal-content ul li{margin-bottom:1rem}body.subscription-panel-injected .subscription-panel-settings-modal-content ul li label{display:block;margin-bottom:.5rem}body.subscription-panel-injected .subscription-panel-settings-modal-content ul li label.danger{background-color:RGBA(255,0,0,.1);border:1px solid RGBA(255,0,0,.5);padding:.5rem;color:var(--kbin-section-text-color);margin:2em 0}body.subscription-panel-injected .subscription-panel-settings-modal-content ul li .description{font-size:.8em;font-weight:100;font-style:italic;opacity:.8}body.subscription-panel-injected .subscription-panel-settings-modal-content ul li input[type=checkbox]{margin-right:.5rem}body.subscription-panel-injected .subscription-panel-settings-modal-content ul li input[type=button]{margin-right:.5rem;padding:.5rem}body.subscription-panel-injected .subscription-panel-settings-modal-content ul li input[type=button]:active{opacity:.8}body.subscription-panel-injected .subscription-panel-settings-modal-content h2{margin-top:0}@keyframes modalopen{0%{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}body.subscription-panel-injected #subscription-panel-collapse-button{position:relative;display:inline-block;right:0;margin:.5rem;padding:.5rem;color:var(--kbin-section-text-color);font-size:.8em;cursor:pointer;transition:transform .2s ease-in-out}body.subscription-panel-injected.subscription-panel-collapsed #subscription-panel h3:hover #subscription-panel-collapse-button{transform:translate(2px)}body.subscription-panel-injected #subscription-panel h3:hover #subscription-panel-collapse-button{color:var(--kbin-sidebar-header-text-color);transform:translate(-2px)}body.subscription-panel-injected:not(.subscription-panel-force-mobile,.subscription-panel-open,.sidebar-left) #middle>.kbin-container{grid-template-areas:"subscription-panel main sidebar";grid-template-columns:minmax(200px,1fr) 3fr 1fr}body.subscription-panel-injected.sidebar-left:not(.subscription-panel-force-mobile,.subscription-panel-open) #middle>.kbin-container{grid-template-areas:"sidebar main subscription-panel";grid-template-columns:1fr 3fr minmax(200px,1fr)}body.subscription-panel-injected.subscription-panel-collapsed:not(.subscription-panel-force-mobile,.subscription-panel-open) #middle>.kbin-container{grid-template-columns:minmax(100px,120px) 3fr 1fr}body.subscription-panel-injected.subscription-panel-collapsed.sidebar-left:not(.subscription-panel-force-mobile,.subscription-panel-open) #middle>.kbin-container{grid-template-columns:1fr 3fr minmax(100px,120px)}body.subscription-panel-injected.subscription-panel-collapsed #middle>.kbin-container #subscription-panel #subscription-panel-edit-button{display:none}body.subscription-panel-injected.subscription-panel-collapsed #middle>.kbin-container #subscription-panel #subscription-panel-collapse-button{margin:0;padding:0 .5em}body.subscription-panel-injected.subscription-panel-collapsed #middle>.kbin-container #subscription-panel li{font-size:.8em}body.subscription-panel-injected.subscription-panel-collapsed #middle>.kbin-container #subscription-panel .search-box-container{display:none}body.subscription-panel-injected.subscription-panel-collapsed.subscription-panel-hide-on-collapse #middle>.kbin-container #subscription-panel ul{display:none}body.subscription-panel-injected.subscription-panel-collapsed.subscription-panel-hide-on-collapse #middle>.kbin-container .last-clicked-container{display:none}body.subscription-panel-injected:not(.subscription-panel-force-mobile,.subscription-panel-open) .sidebar-left #middle>.kbin-container{grid-template-areas:"sidebar main subscription-panel";grid-template-columns:1fr 3fr minmax(200px,1fr)}body.subscription-panel-injected.subscription-panel-collapsed:not(.subscription-panel-force-mobile,.subscription-panel-open) .sidebar-left #middle>.kbin-container{grid-template-columns:1fr 3fr minmax(100px,120px)}body.subscription-panel-injected #subscription-panel-content{background-color:var(--kbin-section-bg);border:var(--kbin-options-border);color:var(--kbin-section-text-color);margin-bottom:.5rem;padding:2rem 1rem;height:fit-content;font-size:.8em;margin-right:.5rem;position:relative}body.subscription-panel-injected #subscription-panel.edit-mode h3,body.subscription-panel-injected #subscription-panel.edit-mode .last-clicked-container,body.subscription-panel-injected #subscription-panel.edit-mode #subscription-panel-settings-button{display:none}body.subscription-panel-injected #subscription-panel.edit-mode .search-box-container{margin-top:2em}body.subscription-panel-injected #subscription-panel.edit-mode .group.open>ul{width:auto}body.subscription-panel-injected #subscription-panel h3{border-bottom:var(--kbin-sidebar-header-border);color:var(--kbin-sidebar-header-text-color);font-size:.8rem;margin:0 0 1em;text-transform:uppercase;width:100%}body.subscription-panel-injected #subscription-panel .last-clicked-container{border-bottom:var(--kbin-sidebar-header-border)}body.subscription-panel-injected #subscription-panel .last-clicked-container.hideItem{display:none}body.subscription-panel-injected #subscription-panel .last-clicked-container h3{margin-top:1em}body.subscription-panel-injected #subscription-panel ul{list-style:none;line-height:2.5em;padding-inline:0}body.subscription-panel-injected #subscription-panel ul.fade-in,body.subscription-panel-injected #subscription-panel ul li.fade-in{animation:showItem .5s ease-in-out}body.subscription-panel-injected #subscription-panel ul li{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}body.subscription-panel-injected #subscription-panel ul li.ignore:not(.edit-mode){display:none}body.subscription-panel-injected #subscription-panel ul li.hideItem{animation:hideItem .25s ease-in-out;animation-fill-mode:forwards}body.subscription-panel-injected #subscription-panel ul li .magazine{transition:transform .2s ease-in-out;display:inline-block}body.subscription-panel-injected #subscription-panel ul li .tools .toolItem{display:inline-block;margin-right:.5rem;cursor:pointer;color:var(--kbin-link-color)}body.subscription-panel-injected #subscription-panel ul li .tools .toolItem:hover{color:var(--kbin-link-hover-color)}body.subscription-panel-injected #subscription-panel ul li.starred .toolItem.star{color:RGBA(255,215,0,1)}body.subscription-panel-injected #subscription-panel ul li.starred .toolItem.star:hover{color:RGBA(255,215,0,.8)}body.subscription-panel-injected #subscription-panel ul li.ignore .toolItem.ignore{color:var(--kbin-link-hover-color)}body.subscription-panel-injected #subscription-panel ul li.ignore .toolItem.ignore:hover{opacity:.8}body.subscription-panel-injected #subscription-panel ul li.edit-mode .magazine{transform:translate(3.5em)}body.subscription-panel-injected #subscription-panel ul li.edit-mode.group .count{display:none}body.subscription-panel-injected #subscription-panel ul li.edit-mode .tools{display:inline-block;animation:showTools .5s ease-in-out;position:absolute}@keyframes showTools{0%{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}body.subscription-panel-injected #subscription-panel ul li .tools{display:none}body.subscription-panel-injected #subscription-panel ul li a img{height:1.4em;margin-right:.5em;border-radius:50%;vertical-align:middle}body.subscription-panel-injected #subscription-panel ul li.no-image a.magazine{padding-left:1.9em}body.subscription-panel-injected #subscription-panel ul li.group{font-weight:700}body.subscription-panel-injected #subscription-panel ul li.group a.group-name .name{margin-left:.5em}body.subscription-panel-injected #subscription-panel ul li.group a.group-name .count{margin-left:.25em;font-weight:400;opacity:.8}body.subscription-panel-injected #subscription-panel ul li.group a.group-name .image{font-size:1.2em;vertical-align:middle;width:1.2em}body.subscription-panel-injected #subscription-panel ul li.group ul{margin-left:.75em;padding-left:.75em;padding-right:.75em;border-left:var(--kbin-sidebar-header-border);border-bottom:var(--kbin-sidebar-header-border);width:fit-content;border-bottom-left-radius:.5rem;display:none}body.subscription-panel-injected #subscription-panel ul li.group ul li{font-weight:400}body.subscription-panel-injected #subscription-panel ul li.group.open ul{animation:openGroup .25s ease-in-out;display:block}body.subscription-panel-injected #subscription-panel .instance-name{opacity:.8;font-weight:100}@keyframes openGroup{0%{transform:translateY(-.5em);opacity:0}to{transform:translateY(0);opacity:1}}body.subscription-panel-injected #subscription-panel-spinner{text-align:center;font-size:2em}@keyframes showItem{0%{opacity:0}to{opacity:1}}@keyframes hideItem{0%{opacity:1;max-height:2.5em}to{opacity:0;max-height:0}}body.subscription-panel-injected #header menu li a.subscription-panel-mobile-button{display:none}@keyframes showMobileSubscriptionPanelUL{0%{transform:translateY(-2em)}to{transform:translateY(0)}}@keyframes showMobileSubscriptionPanel{0%{opacity:0}to{opacity:1}}body.subscription-panel-injected.subscription-panel-open{overflow:hidden}body.subscription-panel-injected.subscription-panel-open #scroll-top{display:none!important}body.subscription-panel-injected.subscription-panel-open #subscription-panel{z-index:5;top:0;height:100%;width:100%;left:0;position:fixed;margin:0}body.subscription-panel-injected.subscription-panel-open.subscription-panel-force-mobile #middle>.kbin-container #subscription-panel,body.subscription-panel-injected.subscription-panel-open.subscription-panel-open #middle>.kbin-container #subscription-panel{overflow:hidden;border-radius:0!important;border:none;background:RGBA(0,0,0,.5);backdrop-filter:blur(2px);display:flex;align-items:center;justify-content:center}body.subscription-panel-injected.subscription-panel-open.subscription-panel-force-mobile #middle>.kbin-container #subscription-panel #subscription-panel-content,body.subscription-panel-injected.subscription-panel-open.subscription-panel-open #middle>.kbin-container #subscription-panel #subscription-panel-content{height:100%;overflow:auto;padding:1em 10em;padding-bottom:100px!important;position:fixed;top:49px;width:fit-content;margin:2em 0 0;animation:showMobileSubscriptionPanel .2s ease-out}body.subscription-panel-injected.subscription-panel-open.subscription-panel-force-mobile #middle>.kbin-container #subscription-panel ul,body.subscription-panel-injected.subscription-panel-open.subscription-panel-open #middle>.kbin-container #subscription-panel ul{animation:showMobileSubscriptionPanelUL .2s ease-out}body.subscription-panel-injected.subscription-panel-open.rounded-edges #middle>.kbin-container #subscription-panel-content{border-radius:.5rem}body.subscription-panel-injected.subscription-panel-open #header menu li a.subscription-panel-mobile-button{border-bottom:var(--kbin-header-hover-border)}body.subscription-panel-injected.subscription-panel-force-mobile:not(.subscription-panel-open) #middle>.kbin-container #subscription-panel{display:none}body.subscription-panel-injected #header menu li a.subscription-panel-mobile-button{font-size:0;cursor:pointer;transition:border-bottom .2s ease-in-out}body.subscription-panel-injected.subscription-panel-force-mobile #header menu li a.subscription-panel-mobile-button,body.subscription-panel-injected.subscription-panel-open #header menu li a.subscription-panel-mobile-button{display:block}body.subscription-panel-injected.subscription-panel-force-mobile #subscription-panel-collapse-button,body.subscription-panel-injected.subscription-panel-open #subscription-panel-collapse-button{display:none}body.subscription-panel-injected a.subscription-panel-mobile-button i{font-size:.85rem}@media (max-width: 991.98px){body.subscription-panel-injected #header menu li a.subscription-panel-mobile-button{display:block}body.subscription-panel-injected #middle>.kbin-container,body.subscription-panel-injected body.subscription-panel-collapsed #middle>.kbin-container{grid-template-areas:"main main" "subscription-panel subscription-panel" "sidebar sidebar"!important;grid-template-columns:1fr!important}body.subscription-panel-injected.subscription-panel-sticky #middle>.kbin-container #subscription-panel{display:none}body.subscription-panel-injected.subscription-panel-open #middle>.kbin-container #subscription-panel{animation:showMobileSubscriptionPanel .2s ease-out}body.subscription-panel-injected.subscription-panel-open #middle>.kbin-container #subscription-panel #subscription-panel-content{height:100%;left:0;padding:2em 2em 100px!important;width:100%!important;border-radius:0!important;border:none;top:49px!important;margin:0!important;overflow:auto}body.subscription-panel-injected.subscription-panel-open #middle>.kbin-container #subscription-panel ul{animation:showMobileSubscriptionPanelUL .2s ease-out}body.subscription-panel-injected #subscription-panel-collapse-button{display:none}body.subscription-panel-injected #subscription-panel-settings-button{right:1em}body.subscription-panel-injected #subscription-panel-edit-button{right:4em;left:unset}body.subscription-panel-injected #subscription-panel.edit-mode #subscription-panel-edit-button{right:1em}}@media (hover: none){body.subscription-panel-injected #header menu li a.subscription-panel-mobile-button:hover{border-bottom:3px solid transparent}body.subscription-panel-injected #subscription-panel-settings-button:hover i,body.subscription-panel-injected #subscription-panel-edit-button:hover i{transform:none!important}}@media (pointer: coarse){body.subscription-panel-injected #subscription-panel-settings-button,body.subscription-panel-injected #subscription-panel-edit-button{font-size:1.2em}}body.subscription-panel-injected .subscription-panel-onboarding .subscription-panel-onboarding-content{max-width:800px}body.subscription-panel-injected .subscription-panel-onboarding-next{margin-top:1em;font-size:2em;text-align:center;display:block}')});function p(){let l=localStorage.getItem("subscription-panel-settings"),e={};return l&&(e=JSON.parse(l)),e.useCache===void 0&&(e.useCache=!0),e.useGroups===void 0&&(e.useGroups=!0),e.showLastClicked===void 0&&(e.showLastClicked=!0),e}function m(l){localStorage.setItem("subscription-panel-settings",JSON.stringify(l))}function U(){localStorage.removeItem("subscription-panel-settings"),localStorage.removeItem("subscription-panel-magazine-data")}var E=f(()=>{});var M,u,w=f(()=>{M=class l{#e;type;fullName;editMode;hidden=!1;element;static get TYPE(){return{MAGAZINE:"magazine",GROUP:"group"}}constructor(e,t){this.fullName=e,this.name=e,this.type=t,this.#e=null,this.editMode=!1}get icon(){return this.#e}getElement(){let e=document.createElement("li");return e.classList.add("item"),e.setAttribute("data-type",this.type),e.setAttribute("data-name",this.fullName),e}enableEditMode(){this.editMode=!0}disableEditMode(){this.editMode=!1}toggleEditMode(){this.editMode?this.disableEditMode():this.enableEditMode()}isStarred(){return!1}isHidden(){return this.hidden}hide(e=!1){this.hidden=!0,this.element&&this.element.classList.add("hideItem")}show(e=!1){this.hidden&&(this.hidden=!1,this.element&&(e&&this.element.classList.contains("hideItem")&&(this.element.addEventListener("animationend",()=>{this.element.classList.remove("fade-in")}),this.element.classList.add("fade-in")),this.element.classList.remove("hideItem")))}toggleHidden(){this.isHidden()?this.hide():this.show()}isIgnored(){return!1}search(e,t=!1){return!t&&this.isIgnored()?!1:this.fullName.toLowerCase().includes(e.toLowerCase())}copy(){return new l(this.fullName,this.type)}},u=M});var C,h,x=f(()=>{w();C=class l extends u{icon;element;starred;constructor(e,t,i=null){super(e,u.TYPE.MAGAZINE),this.icon=i,this.url=t,this.name=e.replace(/@.*/,"");let n=e.match(/@(.*)/);this.instanceName=n?n[1]:null}registerClickTime(){this.appendMagazineData({clickTime:Date.now()})}getMagazineData(){let e=localStorage.getItem("subscription-panel-magazine-data");return e?(e=JSON.parse(e),e=e[this.fullName]||{}):e={},e}getClickTime(){return this.getMagazineData().clickTime||0}appendMagazineData(e){let t=localStorage.getItem("subscription-panel-magazine-data");t?t=JSON.parse(t):t={},t[this.fullName]?t[this.fullName]={...t[this.fullName],...e}:t[this.fullName]=e,localStorage.setItem("subscription-panel-magazine-data",JSON.stringify(t))}static fromElement(e){let t=e.querySelector("a");return new l(t.innerText,t.href,e.querySelector("figure img")?.src)}enableEditMode(){super.enableEditMode(),this.element&&this.element.classList.add("edit-mode")}disableEditMode(){super.disableEditMode(),this.element&&this.element.classList.remove("edit-mode")}toggleStar(){this.getMagazineData()?.starred?this.unstar():this.star()}star(){this.appendMagazineData({starred:!0}),this.element.classList.add("starred"),this.starred=!0}unstar(){this.appendMagazineData({starred:!1}),this.element.classList.remove("starred"),this.starred=!1}isStarred(){return this.starred===void 0&&(this.starred=this.getMagazineData()?.starred===!0),this.starred}ignore(){this.element.classList.add("ignore"),this.ignored=!0,this.appendMagazineData({ignored:!0}),this.element.querySelector(".toolItem.ignore").innerHTML='<i class="fas fa-eye-slash"></i>'}unignore(){this.element.classList.remove("ignore"),this.ignored=!1,this.appendMagazineData({ignored:!1}),this.element.querySelector(".toolItem.ignore").innerHTML='<i class="fas fa-eye"></i>'}toggleIgnored(){this.isIgnored()?this.unignore():this.ignore()}isIgnored(){return this.ignored===void 0&&(this.ignored=this.getMagazineData()?.ignored===!0),this.ignored}getElement(){if(this.element)return this.element;let e=this.getMagazineData(),t=document.createElement("li");e?.starred&&t.classList.add("starred"),this.isIgnored()&&t.classList.add("ignore");let i=Object.assign(document.createElement("span"),{className:"tools"}),n=Object.assign(document.createElement("span"),{className:"star toolItem",title:"Star",innerHTML:'<i class="fas fa-star"></i>',onclick:()=>{this.toggleStar()}}),s=Object.assign(document.createElement("span"),{className:"ignore toolItem",title:"Ignore",innerHTML:this.isIgnored()?'<i class="fas fa-eye-slash"></i>':'<i class="fas fa-eye"></i>',onclick:()=>{this.toggleIgnored()}});i.appendChild(n),i.appendChild(s),t.appendChild(i),this.element=t;let a=document.createElement("a");if(a.href=this.url,a.className="magazine",a.addEventListener("click",()=>{this.registerClickTime()}),a.title=this.fullName,this.icon){let o=document.createElement("img");o.src=this.icon,a.appendChild(o)}else t.classList.add("no-image");let r=document.createElement("span");if(r.className="name",r.appendChild(document.createTextNode(this.name)),a.appendChild(r),this.instanceName){let o=document.createElement("span");o.className="instance-name",o.appendChild(document.createTextNode("@"+this.instanceName)),a.appendChild(o)}return t.appendChild(a),t}static fromJSON(e){return new l(e.fullName,e.url,e.icon)}toJSON(){return{fullName:this.fullName,icon:this.icon,url:this.url,type:this.type}}copy(){return new l(this.fullName,this.url,this.icon)}},h=C});var z,S,P=f(()=>{w();x();z=class l extends u{#e=!1;element;magazines=[];countElement;constructor(e,t){super(e,u.TYPE.GROUP),this.magazines=t,this.name=e}set isOpen(e){this.#e=!!e}get isOpen(){return!!this.#e}get icon(){return this.isOpen?'<i class="fas fa-box-open image"></i>':'<i class="fas fa-box image"></i>'}getClickTime(){let e=0;return this.magazines.forEach(t=>{t.getClickTime()>e&&(e=t.getClickTime())}),e||0}static fromElement(e){let t=e.querySelector("a");return new l(t.innerText,e.querySelector("figure img")?.src,t.href)}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen=!0,this.element.classList.add("open");let e=this.element.querySelector("a"),t=e.querySelector("i");e.setAttribute("aria-expanded","true"),t.classList.remove("fa-box"),t.classList.add("fa-box-open")}close(){this.isOpen=!1,this.element.classList.remove("open");let e=this.element.querySelector("a"),t=e.querySelector("i");e.setAttribute("aria-expanded","false"),t.classList.remove("fa-box-open"),t.classList.add("fa-box")}getElement(){if(this.element)return this.element;let e=this.magazineCount(),t=document.createElement("li");this.element=t,t.classList.add("group"),(this.isIgnored()||e===0)&&t.classList.add("ignore");let i=document.createElement("a");i.className="group-name",i.href="#",i.title=this.fullName,i.ariaLabel=this.fullName,i.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),this.toggle()});let n=Object.assign(document.createElement("span"),{className:"count",innerHTML:"("+e+")"});this.countElement=n,i.innerHTML=this.icon+'<span class="name">'+this.fullName+"</span>",i.appendChild(n),t.appendChild(i);let s=document.createElement("ul");return this.magazines.forEach(a=>{let r=a.getElement();s.appendChild(r)}),t.appendChild(s),t}static fromJSON(e){return new l(e.fullName,e.magazines.map(t=>h.fromJSON(t)))}toJSON(){return{fullName:this.fullName,magazines:this.magazines.map(e=>e.toJSON()),type:this.type}}copy(){return new l(this.fullName,this.magazines.map(e=>e.copy()))}enableEditMode(){super.enableEditMode(),this.element&&(this.magazines.forEach(e=>{e.enableEditMode()}),this.open(),this.element.classList.add("edit-mode"))}disableEditMode(){super.disableEditMode(),this.element&&(this.magazines.forEach(e=>{e.disableEditMode()}),this.close(),this.element.classList.remove("edit-mode"),this.isIgnored()?this.element.classList.add("ignore"):this.element.classList.remove("ignore"),this.countElement.innerHTML="("+this.magazineCount()+")")}isStarred(){return this.magazines.some(e=>e.isStarred())}isIgnored(){return this.magazineCount()===0}hide(e=!1){super.hide(),this.element&&(this.magazines.forEach(t=>{t.hide(e)}),this.element.classList.add("hideItem"))}show(e=!1){super.show(e)}showAll(e=!1){super.show(e),this.element&&this.magazines.forEach(t=>{t.show()})}magazineCount(){let e=0;return this.magazines.forEach(t=>{t.isIgnored()||e++}),e}search(e,t=!1){let i=super.search(e,t);return!i&&!t&&this.isIgnored()?!1:(this.magazines.forEach(n=>{n.search(e,t)&&(i=!0)}),i)}},S=z});var N,v,j=f(()=>{E();P();x();w();N=class{constructor(){localStorage.removeItem("subscription-panel-cache")}save(e){let t=p(),i={cache:e,timestamp:Date.now(),version:1};t?.useCache&&localStorage.setItem("subscription-panel-item-cache",JSON.stringify(i))}remove(){localStorage.removeItem("subscription-panel-item-cache")}parseItem(e){if(e.type===u.TYPE.MAGAZINE)return new h(e.fullName,e.url,e.icon);if(e.type===u.TYPE.GROUP){let t=[];return e.magazines.forEach(i=>{t.push(this.parseItem(i))}),new S(e.fullName,t)}}get(){if(p()?.useCache){let t=localStorage.getItem("subscription-panel-item-cache");if(t){let i=JSON.parse(t);if(i.version===1){let n=[];return i.cache.forEach(s=>{n.push(this.parseItem(s))}),n}else return this.remove(),[]}}return[]}},v=N});var T,Y,J=f(()=>{E();j();T=class{subscriptionsPanel;modalElement;constructor(e){this.subscriptionsPanel=e}getSettingsButtonElement(){let e=document.createElement("div");return e.id="subscription-panel-settings-button",e.title="Settings",e.ariaLabel="Settings",e.innerHTML='<i class="fa-solid fa-cog"></i>',e.addEventListener("click",()=>{this.show()}),e}init(){let e=this.getSettingsButtonElement();this.subscriptionsPanel.contentElement.appendChild(e),this.applySettings(),window.addEventListener("open-subscriptions-panel-settings",()=>{this.show()}),setTimeout(()=>{let t=document.KUP,i=t?.settingsPanel,n=t?.components?.SettingsPanelButtonRow,s=t?.components?.SettingsPanelSection;if(i&&n&&s){let a=new s("Subscriptions Panel");a.addSettingsRows([new n("Open settings",{label:"Open",onClick:()=>{window.dispatchEvent(new CustomEvent("open-subscriptions-panel-settings"))}})]),i.addSection(a)}},100)}close(){this.modalElement&&(this.modalElement.remove(),this.modalElement=null)}registerCheckbox(e,t,i=!1,n=null){let s=document.getElementById(e);p()?.[t]===!0&&(s.checked=!i),s.addEventListener("change",r=>{let o=p();o[t]=!!r.target.checked,m(o),n&&n(s.checked)})}show(){let e=p(),t=document.createElement("div");this.modalElement=t,t.className="subscription-panel-settings-modal subscription-panel-modal",t.innerHTML=`
        <div class="subscription-panel-settings-modal-content subscription-panel-modal-content">
            <div class="subscription-panel-settings-modal-header">
                <span class="close" title="Close settings" aria-label="Close settings">
                    <i class="fa-solid fa-times"></i>
                </span>
                <h2>Subscriptions Panel Settings</h2>
            </div>
            <div class="subscription-panel-settings-modal-body">
                <ul>
                    <li>
                        <label>
                            <input type="checkbox" id="subscription-panel-extend-width" />
                            Extend page width
                            <span class="description">Extend the page width to fit the subscriptions panel</span>
                        </label>
                        <label>
                            <input type="checkbox" id="subscription-panel-hide-on-collapse" />
                            Hide on collapse
                            <span class="description">Hide magazines when panel is collapsed</span>
                        </label>
                        <label>
                            <input type="checkbox" id="subscription-panel-use-cache" />
                            Cache subscriptions
                            <span class="description">Cache subscriptions to load the panel quicker.</span>
                        </label>
                        <label>
                            <input type="checkbox" id="subscription-panel-force-mobile" />
                            Always show mobile menu
                            <span class="description">Always show the mobile menu, even on desktop.</span>
                        </label>
                        <label>
                            <input type="checkbox" id="subscription-panel-use-groups" />
                            Group identical names
                            <span class="description">Group magazines with the same name but from different instances.</span>
                        </label>
                        <label>
                            <input type="checkbox" id="subscription-panel-show-last-clicked" />
                            Show recently viewed
                            <span class="description">Show recently viewed magazines.</span>
                        </label>
                        <label>
                            <input type="checkbox" id="subscription-panel-sticky" />
                            Sticky panel
                            <span class="description">Make the panel stick to the top and scroll independently.</span>
                        </label>
                        <label>
                            <input type="checkbox" id="subscription-panel-show-onboarding" />
                            Show onboarding
                            <span class="description">Show the onboarding step again on next load.</span>
                        </label>
                        <label class="danger">
                            <input type="button" id="subscription-panel-reset" value="Reset settings"/>
                            <span class="description">Removes all cached data and resets settings to default.</span>
                        </label>
                    </li>
            </div>
        </div>
        `,document.body.appendChild(t);let i=t.querySelector("#subscription-panel-extend-width");e?.extendWidth&&(i.checked=!0);let n=t.querySelector("#subscription-panel-hide-on-collapse");e?.hideOnCollapse&&(n.checked=!0);let s=t.querySelector("#subscription-panel-use-cache");e?.useCache&&(s.checked=!0);let a=t.querySelector("#subscription-panel-show-onboarding");e?.onboardingDone&&(a.checked=!1);let r=t.querySelector("#subscription-panel-force-mobile");e?.forceMobile&&(r.checked=!0);let o=t.querySelector("#subscription-panel-use-groups");e?.useGroups&&(o.checked=!0);let y=t.querySelector("#subscription-panel-show-last-clicked");e?.showLastClicked&&(y.checked=!0),this.registerCheckbox("subscription-panel-sticky","sticky",!1,()=>{this.applySettings()}),t.querySelector("#subscription-panel-reset").addEventListener("click",()=>{new v().remove(),U(),window.location.reload()}),t.querySelector(".subscription-panel-settings-modal .close").addEventListener("click",()=>{this.close()}),t.addEventListener("click",c=>{c.target===t&&this.close()}),t.querySelector("#subscription-panel-extend-width").addEventListener("change",c=>{let d=p();d.extendWidth=!!c.target.checked,m(d),this.applySettings()}),t.querySelector("#subscription-panel-use-cache").addEventListener("change",c=>{let d=p();c.target.checked?d.useCache=!0:(d.useCache=!1,new v().remove()),m(d),this.applySettings()}),t.querySelector("#subscription-panel-hide-on-collapse").addEventListener("change",c=>{let d=p();d.hideOnCollapse=!!c.target.checked,m(d),this.applySettings()}),t.querySelector("#subscription-panel-show-onboarding").addEventListener("change",c=>{let d=p();d.onboardingDone=!c.target.checked,m(d)}),t.querySelector("#subscription-panel-use-groups").addEventListener("change",c=>{let d=p();d.useGroups=!!c.target.checked;let g=this.subscriptionsPanel.subscriptionsHandler;g.reload().then(()=>{this.subscriptionsPanel.addMagazinesToDOM(g.subscriptions,!0)}),m(d),this.applySettings()}),t.querySelector("#subscription-panel-force-mobile").addEventListener("change",c=>{let d=p();d.forceMobile=!!c.target.checked,m(d),this.applySettings()}),t.querySelector("#subscription-panel-show-last-clicked").addEventListener("change",c=>{let d=p();d.showLastClicked=!!c.target.checked;let g=this.subscriptionsPanel.subscriptionsHandler;g.reload().then(()=>{this.subscriptionsPanel.addMagazinesToDOM(g.subscriptions,!0)}),m(d),this.applySettings()})}applySettings(){let e=p();e?.extendWidth?document.body.classList.add("extend-width"):document.body.classList.remove("extend-width"),e?.collapsed?this.subscriptionsPanel.collapsePanel():this.subscriptionsPanel.expandPanel(),e?.hideOnCollapse?document.body.classList.add("subscription-panel-hide-on-collapse"):document.body.classList.remove("subscription-panel-hide-on-collapse"),e?.forceMobile?document.body.classList.add("subscription-panel-force-mobile"):(document.body.classList.remove("subscription-panel-force-mobile"),this.subscriptionsPanel.closeMobilePanel()),e?.sticky?document.body.classList.add("subscription-panel-sticky"):document.body.classList.remove("subscription-panel-sticky")}},Y=T});var I,W,F=f(()=>{E();j();x();w();P();I=class{subscriptions;constructor(){this.subscriptions=[]}reload(){return this.subscriptions=[],this.load(1)}sort(){let e=(t,i)=>t.isStarred()&&!i.isStarred()?-1:!t.isStarred()&&i.isStarred()?1:t.fullName.localeCompare(i.fullName);this.subscriptions.sort((t,i)=>e(t,i)),this.subscriptions.forEach(t=>{t.type===u.TYPE.GROUP&&t.magazines.sort((i,n)=>e(i,n))})}append(e){let i=p()?.useGroups;e.forEach(s=>{let a=!1;this.subscriptions.some((r,o)=>(r.type===u.TYPE.MAGAZINE&&s.type===u.TYPE.MAGAZINE&&r.url===s.url?a=!0:i&&r.name.toLowerCase()===s.name.toLowerCase()&&(r.type===u.TYPE.GROUP?r.magazines.push(s):this.subscriptions[o]=new S(r.name,[r,s]),a=!0),a)),a||this.subscriptions.push(s)}),this.sort(),new v().save(this.subscriptions)}load(e){e=e||1;let t="/settings/subscriptions/magazines?p="+e;return fetch(t).then(n=>{let s=document.querySelector("#subscription-panel-spinner");return s&&s.remove(),n.text()}).then(n=>{let s=new DOMParser().parseFromString(n,"text/html"),a=s.querySelectorAll(".section.magazines.magazines-columns ul>li"),r=[];if(a.length===0)return document.querySelector("#subscription-panel-content").appendChild(document.createTextNode("No subscriptions found")),Promise.resolve();a.forEach(y=>{let b=h.fromElement(y);r.push(b);let c=window.location.pathname.match(/\/m\/(.+?)(\/|$)/);c&&c[1]===b.fullName&&b.registerClickTime()}),this.append(r);let o=s.querySelector("a.pagination__item.pagination__item--next-page")?.href;return o=o?o.match(/p=(\d+)/)[1]:void 0,o=o?parseInt(o):1,e<o&&e<100?this.load(e+1):Promise.resolve()}).catch(n=>(console.error(n),document.querySelector("#subscription-panel-content").appendChild(document.createTextNode("Failed to load subscriptions")),Promise.reject(n)))}loadSubscriptions(e,t){e=e||1;let i=new XMLHttpRequest;i.onreadystatechange=()=>{if(i.readyState===4){let n=document.querySelector("#subscription-panel-spinner");if(n&&n.remove(),i.status===200){let s=new DOMParser().parseFromString(i.responseText,"text/html"),a=s.querySelectorAll(".section.magazines.magazines-columns ul>li"),r=[];a.forEach(y=>{let b=h.fromElement(y);r.push(b),window.location&&window.location.pathname===b.url&&b.registerClickTime()}),this.append(r);let o=s.querySelector("a.pagination__item.pagination__item--next-page")?.href;o=o?o.match(/p=(\d+)/)[1]:void 0,o=o?parseInt(o):1,e<o&&e<100?this.loadSubscriptions(e+1,t):t&&t(this.subscriptions)}else document.querySelector("#subscription-panel-content").appendChild(document.createTextNode("Failed to load subscriptions"))}},i.open("GET","/settings/subscriptions/magazines?p="+e,!0),i.send()}},W=I});var q,Z,Q=f(()=>{x();q=class{#e;#t;panelElement;searchQuery="";#i=!1;constructor(e,t){this.subscriptionsHandler=e,this.panelElement=t}clear(){this.doSearch("")}set editMode(e){this.#i=!!e,this.doSearch(this.searchQuery)}get editMode(){return this.#i}doSearch(e){e=e.trim(),this.searchQuery=e,this.#e.value=e;let t=this.panelElement.querySelector(".last-clicked-container");if(e.length>0)this.#t.querySelector(".search-box-clear")?.classList.add("active");else{this.#t.querySelector(".search-box-clear")?.classList.remove("active"),t.classList.remove("hideItem"),this.subscriptionsHandler.subscriptions.forEach(i=>{i.type===h.TYPE.GROUP?(i.showAll(),this.editMode?i.open():i.close()):i.show()});return}e=e.toLowerCase(),t.classList.add("hideItem"),this.subscriptionsHandler.subscriptions.forEach(i=>{if(i.type===h.TYPE.GROUP){i.open();let n=!1;i.magazines.forEach(s=>{s.search(e,this.editMode)?(n=!0,s.show(!0)):s.hide(!0)}),n?i.show(!0):i.hide(!0)}else i.type===h.TYPE.MAGAZINE&&(i.search(e,this.editMode)?i.show(!0):i.hide(!0))})}getElement(){if(this.#e)return this.#e;let e=document.createElement("input");this.#e=e,e.type="text",e.id="subscription-panel-search",e.placeholder="Filter",e.addEventListener("input",n=>{this.doSearch(n.target.value)});let t=document.createElement("span");t.className="search-box-clear",t.innerHTML='<i class="fa-solid fa-times"></i>',t.addEventListener("click",()=>{this.clear()}),e.addEventListener("keydown",n=>{n.key==="Escape"&&(this.clear(),e.blur())});let i=document.createElement("div");return this.#t=i,i.className="search-box-container",i.appendChild(e),i.appendChild(t),i}},Z=q});var O,_,K=f(()=>{j();E();F();Q();x();O=class{subscriptionsHandler;containerElement;contentElement;editMode=!1;constructor(){this.subscriptionsHandler=new W}init(){document.body.classList.add("subscription-panel-injected");let e=document.querySelector("#middle > .kbin-container"),t=document.createElement("div");this.containerElement=t,t.id="subscription-panel";let i=document.createElement("aside");this.contentElement=i;let n=document.createElement("ul");n.className="fade-in subscription-list",n.addEventListener("animationend",()=>{n.classList.remove("fade-in")});let s=document.createElement("h3");i.id="subscription-panel-content",s.innerHTML='<span class="subscription-panel-header">Subscriptions</span>',i.appendChild(s);let a=Object.assign(document.createElement("div"),{id:"subscription-panel-edit-button",title:"Edit subscriptions",ariaLabel:"Edit subscriptions",innerHTML:'<i class="fa-solid fa-pencil"></i>'});a.addEventListener("click",()=>{this.toggleEditMode()}),i.appendChild(a),t.appendChild(i),e.appendChild(t);let r=new Z(this.subscriptionsHandler,t);this.searchBox=r,i.appendChild(r.getElement());let o=document.createElement("span");o.id="subscription-panel-collapse-button",o.title="Hide Subscriptions",o.ariaLabel="Hide Subscriptions",o.innerHTML='<i class="fa-solid fa-chevron-left"></i>',s.addEventListener("click",()=>{this.toggleCollapsePanel()}),s.appendChild(o);let y=document.querySelector(".kbin-container > menu"),b=document.createElement("li"),c=document.createElement("a");c.className="subscription-panel-mobile-button",c.title="Subscriptions",c.ariaLabel="Subscriptions",c.href="#",c.innerHTML='<i class="fa-solid fa-newspaper"></i>',c.addEventListener("click",k=>{this.toggleOpenMobilePanel(),k.preventDefault()}),b.appendChild(c),y.insertBefore(b,y.firstChild),t.addEventListener("click",k=>{k.target===t&&document.body.classList.contains("subscription-panel-open")&&this.closeMobilePanel()}),new MutationObserver(k=>{k.forEach(L=>{L.attributeName==="class"&&L.target.getAttribute(L.attributeName).includes("open")&&this.closeMobilePanel()})}).observe(document.getElementById("sidebar"),{attributes:!0});let g=document.createElement("div");g.className="last-clicked-container",g.appendChild(Object.assign(document.createElement("h3"),{innerText:"Recently viewed"}));let D=document.createElement("ul");D.className="fade-in last-clicked-list",p()?.showLastClicked!==!0&&g.classList.add("hideItem"),g.appendChild(D),i.appendChild(g),i.appendChild(n);let B=new v().get();if(B.length>0)this.addMagazinesToDOM(B,!1);else{let k=document.createElement("div");k.id="subscription-panel-spinner",k.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>',i.appendChild(k)}this.subscriptionsHandler.load().then(()=>{this.addMagazinesToDOM(this.subscriptionsHandler.subscriptions,!0)})}enableEditMode(){this.editMode=!0,this.containerElement.classList.add("edit-mode"),this.expandPanel(),this.subscriptionsHandler.subscriptions.forEach(t=>{t.enableEditMode()}),this.searchBox.editMode=!0;let e=document.getElementById("subscription-panel-edit-button");e.innerHTML='<i class="fa-solid fa-check"></i> Done',e.classList.add("active")}disableEditMode(){this.editMode=!1,this.containerElement.classList.remove("edit-mode"),this.subscriptionsHandler.subscriptions.forEach(t=>{t.disableEditMode()}),this.subscriptionsHandler.sort(),this.addMagazinesToDOM(this.subscriptionsHandler.subscriptions);let e=document.getElementById("subscription-panel-edit-button");e.innerHTML='<i class="fa-solid fa-pencil"></i>',e.classList.remove("active"),this.searchBox.editMode=!1,this.searchBox.clear()}toggleEditMode(){this.editMode?this.disableEditMode():this.enableEditMode()}toggleCollapsePanel(){let e=p();document.body.classList.contains("subscription-panel-collapsed")?(this.expandPanel(),e.collapsed=!1):this.collapsePanel()&&(e.collapsed=!0),m(e)}collapsePanel(){if(window.innerWidth<=991.98||document.body.classList.contains("subscription-panel-force-mobile")||this.editMode)return!1;let e=document.querySelector(".last-clicked-container h3");e&&(e.innerHTML='<i class="fa-solid fa-clock-rotate-left"></i> Recent'),document.body.classList.contains("sidebar-left")?document.querySelector("#subscription-panel-collapse-button i").className="fa-solid fa-chevron-left":document.querySelector("#subscription-panel-collapse-button i").className="fa-solid fa-chevron-right";let t=document.querySelector("#subscription-panel-collapse-button");return t.title="Show subscriptions",t.ariaLabel="Show subscriptions",document.querySelector(".subscription-panel-header").innerHTML='<i class="fa-solid fa-newspaper"></i> Subs',document.body.classList.add("subscription-panel-collapsed"),!0}expandPanel(){document.body.classList.contains("sidebar-left")?document.querySelector("#subscription-panel-collapse-button i").className="fa-solid fa-chevron-right":document.querySelector("#subscription-panel-collapse-button i").className="fa-solid fa-chevron-left";let e=document.querySelector(".last-clicked-container h3");e&&(e.innerText="Recently viewed");let t=document.querySelector("#subscription-panel-collapse-button");return t.title="Hide subscriptions",t.ariaLabel="Hide subscriptions",document.querySelector(".subscription-panel-header").innerText="Subscriptions",document.body.classList.remove("subscription-panel-collapsed"),!0}toggleOpenMobilePanel(){document.body.classList.contains("subscription-panel-open")?this.closeMobilePanel():this.openMobilePanel()}openMobilePanel(){document.body.classList.add("subscription-panel-open"),document.body.classList.contains("fixed-navbar")||window.scrollTo(0,0),document.getElementById("sidebar")?.classList.remove("open")}closeMobilePanel(){document.body.classList.remove("subscription-panel-open")}addMagazinesToDOM(e){let t=document.querySelector("#subscription-panel ul.subscription-list"),i=document.querySelector("#subscription-panel .last-clicked-container"),n=document.querySelector("#subscription-panel ul.last-clicked-list");if(t.innerHTML="",n.innerHTML="",p()?.showLastClicked===!0){i.classList.remove("hideItem");let a=[...e].sort((r,o)=>o.getClickTime()-r.getClickTime()).slice(0,4);a=a.filter(r=>r.getClickTime()>0),a.length===0?i.classList.add("hideItem"):a.forEach(r=>{let o=r.copy();o.type===h.TYPE.GROUP&&o.magazines.sort((b,c)=>c.getClickTime()-b.getClickTime());let y=o.getElement();y.classList.add("last-clicked"),n.appendChild(y)})}else i.classList.add("hideItem");e.forEach(a=>{let r=a.getElement();t.appendChild(r)})}},_=O});var H,V,X=f(()=>{E();H=class{modalElement;constructor(){}init(){let e=p();e?.onboardingDone||(e.onboardingDone=!0,m(e),this.show())}close(){this.modalElement&&(this.modalElement.remove(),this.modalElement=null)}show(){let e=document.createElement("div");this.modalElement=e,e.className="subscription-panel-onboarding subscription-panel-modal",e.innerHTML=`
        <div class="subscription-panel-onboarding-content subscription-panel-modal-content">
            <div class="subscription-panel-onboarding-close close" title="Close onboarding" aria-label="Close onboarding"><i class="fa-solid fa-times"></i></div>
            <h2>Thanks for using Subscriptions Panel!</h2>
            <p>Click on the <i class="fa-solid fa-chevron-left"></i> icon to collapse the panel.</p>
            <p>Click on the <i class="fa-solid fa-cog"></i> icon to open the settings.</p>
            <p>Click on the <i class="fa-solid fa-newspaper"></i> icon to open the panel on mobile.</p>
            <p>Magazines that share the same name are grouped together. A group is indicated by a <i class="fa-solid fa-box"></i> icon.</p>
            <p>Please take a few seconds to review the settings in the next step. You can always do this later if you want.</p>
            <a href="#" class="subscription-panel-onboarding-next">Show settings <i class="fa-solid fa-chevron-right"></i></a>
        </div>
        `,e.querySelector(".subscription-panel-onboarding-close").addEventListener("click",t=>{this.close(),t.preventDefault()}),e.querySelector(".subscription-panel-onboarding-next").addEventListener("click",t=>{this.close(),window.dispatchEvent(new Event("open-subscriptions-panel-settings")),t.preventDefault()}),e.addEventListener("click",t=>{t.target===e&&(this.close(),window.dispatchEvent(new Event("open-subscriptions-panel-settings")),t.preventDefault())}),document.body.appendChild(e)}},V=H});var te=$(()=>{R();J();K();X();var ee=document.querySelector(".login");if(!ee.href.endsWith("/login")){let l=new _,e=new Y(l),t=new V(e);l.init(),e.init(),t.init()}});te();})();
})();
